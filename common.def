#*******************************************************************************
# System Name       ：AGENT
# Owner      　　　 ：Infra
# Process           ：共通変数・関数設定
# Overview          ：共通変数・関数設定
# Script Name       ：common.def
# Arguments         ：1st N/A
#                   ：2nd N/A
#                   ：3rd N/A
# Return Code       ：N/A - OK
#                   　N/A - NG
# Environment       ：ALL
#*******************************************************************************
# History
# 
# Date          Contact                 Changes
# ____________  ______________________  ________________________________________
# 2019/09/13    永井                    新規作成
#*******************************************************************************

# Common Variable
## SHELLINFO
SHELLPATH="${0}"
SHELLFNAME="${0##*/}"
SHELLSNAME="${SHELLFNAME%%.*}"
SHELLPID="${$}"

## LANG
LANG="ja_JP.UTF-8"

## PATH
PATH="${PATH}:/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin"

## DIRECTORY INFO
DIR_COM="/data/infra/scripts"
DIR_BIN="${DIR_COM}/bin"
DIR_DEF="${DIR_COM}/def"
DIR_TMP="${DIR_COM}/tmp"
DIR_LOG="${DIR_COM}/log"

## DATE/TIME INFO
DT=""
DT_COM="$(date '+%Y%m%d%H%M%S')"
DT_YMD="$(date '+%Y%m%d')"
DT_TIME="$(date '+%H%M%S')"

## FILENAME INFO
FILE_TMP="${DIR_TMP}/${SHELLSNAME}_${DT_YMD}.tmp"
FILE_LOG="${DIR_LOG}/${SHELLSNAME}_${DT_YMD}.log"

## RETURN CODE
RC=""
RC_OK="0"
RC_NG="1"

# Common Function
#---------------------------------------------------------------------------
# Function          ：LOG_WRITE
# Overview          ：OUTPUT LOGFILE
# Arguments         ：1st OUTFLAG(0:STDOUT,1:LOGOUT,2:STDOUT&LOGOUT)
#                   ：2nd SEVERITY(ERROR,WARN,INFO)
#                   ：3rd Message(ダブルクォートで囲う)
# Return Code       ：0 - OK
#                   　1 - NG
#---------------------------------------------------------------------------
function LOG_WRITE() {
    # GET ARGUMENTS
    # INITIARIZE
    DT="$(date '+%Y/%m/%d %H:%M:%S')"
    OFLAG="${1}"
    SEV="${2}"
    MSG="${3}"

    # SET MESSAGE
    if [[ "${OFLAG}" -le 2 ]] && [[ "${#}" -eq 3 ]] && [[ "${SEV}" =~ ^(ERROR|WARN|INFO)$ ]]
    then
	OUTMSG="${DT} ${SHELLSNAME}[${SHELLPID}]: ${SEV} ${MSG}"
	RC="${RC_OK}"
    else
	OUTMSG="${DT} ${SHELLSNAME}[${SHELLPID}]: ERROR INVALID ARGUMENT, \
	usage: LOG_WRITE (0|1|2) (ERROR|WARN|INFO) \"MSG\", \
	CURRENT ARGUMENT IS \"${@}\"" 
	RC="${RC_NG}"
    fi

    # OUTPUT MESSAGE
    ## STDOUT
    if [[ "${OFLAG}" -eq 0 ]] || [[ "${OFLAG}" -eq 2 ]]
    then
        echo ${OUTMSG}
    fi
    
    ## LOGOUT
    if [[ "${OFLAG}" -eq 1 ]] || [[ "${OFLAG}" -eq 2 ]]
    then
        echo ${OUTMSG} >> ${FILE_LOG}
    fi

    if [[ "${SEV}" =~ ^(ERROR|WARN)$ ]] 
    then
        logger -t ${SHELLSNAME}[${SHELLPID}] "${SEV} ${MSG}"
    fi

    return ${RC}
}
